<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cascadia Hiking Club</title>

    <!--Bootstrap CSS-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <link rel="shortcut icon" href="https://www.cascadiahiking.club/static/images/mountain_icon.png">
    <style media="screen" type="text/css">
      html, body {
        background: radial-gradient(#60A9EA, #6D6D6D);
        background-image: url(https://www.roadtripsandhikes.org/images/IMG_3348.JPG);
        background-attachment: fixed;
        background-size: cover;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        width: 100%;
        height: auto;
        font-size: 0.95em;
      }
      header {
        background-color: #EEE;
        position: sticky;
        position: -webkit-sticky;
        position: -moz-sticky;
        position: -ms-sticky;
        position: -o-sticky;
        top: 0px;
        left: 0px;
        display:flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        font-size: 1.0em;
        z-index: 999;
        font-weight: bold;
        box-shadow:           3px 3px 5px 0 rgba(25,25,25,0.4);
        -moz-box-shadow:      3px 3px 5px 0 rgba(25,25,25,0.4);
        -webkit-box-shadow:   3px 3px 5px 0 rgba(25,25,25,0.4);
      }
      #header_logo {
        width:100px;
      }
      #pancake {
        display: none;
      }
      .homepage_link, .homepage_link:hover {
        text-decoration: none;
        color: black;
      }
      .left_side_header {
        display:flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: flex-start;
        margin: 5px;
        padding: 5px;
      }
      .right_side_header {
        margin-right: 10px;
      }
      #filter_members {
        display: flex;
        flex-direction: row;
        margin-top: 10px;
        padding: 3px;
      }
      #filter_members > * {
        padding-left: 5px;
      }
      #search_container {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        margin-top: 10px;
      }
      #search_container * {
        padding-right: 7px;
      }
      main {
        margin: 10px auto;
      }
      .container > * {
        padding: 10px;
        background-color: rgba(255,255,255,0.9);
      }
      .nav_buttons {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: auto;
      }
      .search_box {
        width: 400px;
      }
      .nav_buttons > * {
        padding-bottom: 20px;
      }
      label {
        font-weight: bold;
        width: 100px;
        vertical-align: bottom;
      }
      input[type=text], input[type=date] {
        border: none;
        border-bottom: 2px solid #ccc;
        background-color: inherit;
      }
      select {
        padding: 3px 3px;
        border: none;
        border-bottom: 2px solid #ccc;
        border-radius: calc(.3rem - 1px) calc(.3rem - 1px) 0 0;
        background-color: inherit;
      }
      .form_fields > input,
      .form_fields > select {
        width: 25vw;
        margin-bottom: 10px;
      }
      #pagination_top {
        border-radius: calc(.3rem - 1px) calc(.3rem - 1px) 0 0;
        background: linear-gradient(90deg, rgba(222,222,222,0.95), rgba(255,255,255,1.0), rgba(222,222,222,0.95));
      }
      #pagination_bottom {
        border-radius: 0 0 calc(.3rem - 1px) calc(.3rem - 1px);
        text-align: center;
        background: linear-gradient(90deg, rgba(222,222,222,0.95), rgba(255,255,255,1.0), rgba(222,222,222,0.95));
      }
      .pagination {
        margin-bottom: 0;
      }
      h4,h5 {
        margin-bottom: 0;
      }
      .names_title {
        font-weight: bold;
      }
      .byline {
        font-style: italic;
        font-weight: normal;
      }
      .note {
        font-style: italic;
        font-weight: normal;
      }
      .edit_link {
        color: blue;
        text-decoration: none;
        font-size: 0.8em;
      }
      .listing_page_header {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        width: 100%;
        font-size: 0.9em;
        background: linear-gradient(90deg, rgba(255,255,255,1.0), rgba(222,222,222,0.95), rgba(255,255,255,1.0));
      }
      .tile {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        justify-content: space-between;
      }
      .tile:nth-child(odd) {
        background: linear-gradient(90deg, rgba(255,255,255,1.0), rgba(222,222,222,0.95), rgba(255,255,255,1.0));
      }
      .tile:nth-child(even) {
        background: linear-gradient(90deg, rgba(255,255,255,1.0), rgba(202,202,202,0.95), rgba(255,255,255,1.0));
      }
      .cols_left_middle {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        width: 100%;
      }
      .col_left {
        width: 35%;
      }
      .col_middle {
        width: 40%;
        text-align: left;
      }
      .col_right {
        width: 25%;
        text-align: right;
      }
      #show_member_header, #show_person_header, #edit_person_header, #edit_member_header {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        border-radius: calc(.3rem - 1px) calc(.3rem - 1px) 0 0;
        background: linear-gradient(90deg, rgba(255,255,255,1.0), rgba(222,222,222,0.95), rgba(255,255,255,1.0));
      }
      .show_member {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        justify-content: space-around;
      }
      .show_member_board_cmte {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        justify-content: space-between;
      }
      .edit_form_align {
        display: flex;
        flex-direction: row;
        justify-content: flex-start;
        width: auto;
      }
      .col_ro {
        width: 50%;
      }
      .col_rw {
        width: 50%;
      }
      .col_edit {
        width: 120vw;
      }
      .col_show {
        width: 50%;
      }
      .col_50 {
        width: 50%;
      }
      .person_detail_mailing_address > div,
      .member_detail_mailing_address > div {
        margin-left: 20px;
      }
      .submit_btn {
        text-align: center;
      }
      .message {
        color: green;
        border-radius: 3px 3px 0 0;
        margin-left: 10px;
        padding: 2px 4px 2px 4px;
        background-color: #F2F2F2;
      }
      .person_detail_section, .member_detail_section {
        margin-bottom: 10px;
        width: 100%;
      }
      .welcome_hero {
        float: left;
        margin: auto 20px;
        text-align: center;
        border-radius: 3px;
        padding-bottom: 10px;
        width: 30vw;
        box-shadow:           3px 3px 5px 0 rgba(25,25,25,0.4);
        -moz-box-shadow:      3px 3px 5px 0 rgba(25,25,25,0.4);
        -webkit-box-shadow:   3px 3px 5px 0 rgba(25,25,25,0.4);
      }
      .welcome_hero img {
        border-radius: 3px 3px 0 0;
        padding: 10px;
        width: inherit;
      }
      .jumbotron {
        width: 80vw;
        margin: auto;
        padding-bottom: 10px;
        overflow: hidden;
      }
      .welcome_hr {
        border-bottom: 1px solid #333;
        overflow: hidden;
        margin-bottom: 10px;
      }
      .more_info {
        margin-top: 30px;
        width: 100%;
        text-align: left;
        text-align: center;
        background: linear-gradient(90deg, rgba(222,222,222,0.95), rgba(255,255,255,1.0), rgba(222,222,222,0.95));
        border-radius: 3px;
      }
      .more_info p {
        padding: 10px;
      }
      @media all and (max-width: 1440px) {
        /* tbd */
      }
      @media all and (max-width: 800px) {
        header {
          flex-direction: column;
        }
        #pancake {
          display: inline-block;
        }
        #search_container,
        #filter_members {
          display: none;
        }
        .homepage_link {
          font-size: 0.95em;
        }
        .clearfix {
          height: 25px;
          display: inline-block;
        }
        .nav_buttons > div > a {
          width: 75vw;
        }
        .search_box {
          width: 60vw;
        }
        .mobile_nav_buttons {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
        }
        .mobile_nav_buttons > a {
          width: 100%;
          margin-bottom: 10px;
        }
        .right_side_header {
          margin-bottom: 7px;
        }
        .cols_left_middle {
          flex-direction: column;
        }
        .col_left {
          width: auto;
        }
        .col_middle {
          width: auto;
        }
        .col_right {
          width: auto;
        }
        h4 {
          font-size: 1.1em;
        }
        .col_show {
          width: auto;
        }
        .show_member {
          flex-direction: column;
        }
        .edit_form_align {
          flex-direction: column;
        }
        .col_rw {
          width: auto;
        }
        .col_ro {
          width: auto;
        }
        .form_fields > input,
        .form_fields > select {
          width: 100%;
          margin-bottom: 10px;
        }
        .welcome_hero {
          width: 100%;
          margin: auto;
          margin-bottom: 10px;
        }
      }
    </style>
  </head>
    <body>
      <header>
        <div class="left_side_header">
          <div class="display-6"><span id="pancake" style="font-size:28px;cursor:pointer;">&#9776;&nbsp;</span><a href="{% url 'members_app:index' %}" class="homepage_link"><img id="header_logo" src="https://www.cascadiahiking.club/static/images/mountain_logo.png">Cascadia Hiking Club</a></div>
          {% if user.is_authenticated %}
          <div id="filter_members">Show:
            <a href="{% url 'members_app:list_active' %}">Active Members</a>&nbsp;({{user.active_member_count}})
            <a href="{% url 'members_app:list_board' %}">Board Members</a>&nbsp;({{user.board_member_count}})
            <a href="{% url 'members_app:list_committees' %}">Committees</a>&nbsp;({{user.committee_member_count}})
            <a href="{% url 'members_app:list_all' %}">All People</a>&nbsp;({{user.all_member_count}})
            <a href="{% url 'members_app:list_inactive' %}">Inactive Members</a>&nbsp;({{user.inactive_member_count}})
          </div>
          <div id="search_container">
            <span><input type="search" id="q" class="search_box" name="q" placeholder="&nbsp;Search for a Member" required></span>
            <span><button type="submit" class="btn btn-secondary btn-sm" id="search_btn"><b>Search</b></button></span>
            <span><input type="checkbox" class="" name="filter_cb" id="filter_cb"/></span>
            <span>Show Only Board Members</span>
          </div>
          {% endif %}
        </div>
        <div class="right_side_header">
          {% if user.is_authenticated %}
            <span>Hi, {{user.username|title}}. <a href="/logout">Logout</a></span>
          {% else %}
            <span><a href="/login">Login</a></span>
          {% endif %}
        </div>
      </header>

      <main>
        {% block content %}{% endblock %}
      </main>

      <!-- Button trigger modal -->
      <button style="display: none" id="show_edit_address" type="button" class="btn btn-primary" data-toggle="modal" data-target="#editAddressModal"></button>

      <!-- Modal -->
      <div class="modal fade" id="editAddressModal" tabindex="-1" role="dialog" aria-labelledby="editAddressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="edit_AddressModal">Edit Address</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <form action="" method="post" name="address_form" id="address_form">
              <input type="hidden" name="address_id" id="address_id" value="{{address_id}}">
              <input type="hidden" name="member_id" id="member_id" value="{{member.id}}">
                <div class="modal-body">
                    <!-- {% csrf_token %} -->
                    <table>
                        {{ addr_form.as_table }}
                    </table>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="button" id="address_submit_btn" class="btn btn-primary">Save changes</button>
                </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Button trigger modal -->
      <button style="display: none" id="show_mobile_nav" type="button" class="btn btn-primary" data-toggle="modal" data-target="#mobileNavModal"></button>

      <!-- Modal -->
      <div class="modal fade" id="mobileNavModal" tabindex="-1" role="dialog" aria-labelledby="mobileNavModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="mobileNavModal">Menu</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="clearfix"></div>
            <div class="nav_buttons">
              <div><a class="btn btn-primary btn-lg" href="{% url 'members_app:list_active' %}" role="button">Active Members</a></div>
              <div><a class="btn btn-primary btn-lg" href="{% url 'members_app:list_board' %}" role="button">Board Members</a></div>
              <div><a class="btn btn-primary btn-lg" href="{% url 'members_app:list_committees' %}" role="button">Committees</a></div>
              <div><a class="btn btn-primary btn-lg" href="{% url 'members_app:list_all' %}" role="button">All People</a></div>
              <div><a class="btn btn-primary btn-lg" href="{% url 'members_app:list_inactive' %}" role="button">Inactive Members</a></div>
            <div class="clearfix"></div>
            <div>
              <input type="search" id="mobile_q" class="search_box" name="mobile_q" placeholder="&nbsp;Search for a Member" required>
              <button type="submit" class="btn btn-secondary btn-sm" id="mobile_search_btn"><b>Search</b></button>
            </div>
            <div>
              <input type="checkbox" class="" name="filter_cb" id="mobile_filter_cb"/>
              <span>Show Only Board Members</span>
            </div>
          </div>
        </div>
      </div>

      <script type="text/javascript">
        {% if perms.members.change_address %}
          function AjaxFormSubmit() {
            var address_form = document.querySelector('#address_form');
            var data = new FormData(address_form);
            var refresh_url = window.location;
            data.append('csrfmiddlewaretoken', '{{ csrf_token }}');
            data.append('refresh_url', refresh_url);
            $.ajax({
                url: '/save_address/',
                type: "POST",
                data: data,
                cache: false,
                processData: false,
                contentType: false,
                // close modal & reload the address with new data
                success : function(json) {
                    $('#show_edit_address').click();
                    $("#address_fields").load(location.href+" #address_fields>*","");
                    console.log("success: address saved"); // another sanity check
                },
                // handle a non-successful response
                error : function(xhr,errmsg,err) {
                    $('#show_edit_address').click();
                    console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
                }
            });
          };
          {% endif %}
        let address_submit_btn = document.querySelector('#address_submit_btn');
        address_submit_btn.onclick = function() {
          {% if perms.members.change_address %}
            AjaxFormSubmit();
          {% else %}
            alert("This is a demo only. This account cannot make changes.");
          {% endif %}
        }
      </script>

      <script type="text/javascript">
        {% if user.is_authenticated %}
          search_btn = document.querySelector('#search_btn');
          mobile_search_btn = document.querySelector('#mobile_search_btn');
          q = document.querySelector('#q');
          mobile_q = document.querySelector('#mobile_q');
          filter_cb = document.querySelector('#filter_cb');
          mobile_filter_cb = document.querySelector('#mobile_filter_cb');
          search_btn.onclick = function(event) {
            if (q.value.trim() == '') {
              event.preventDefault();
            } else {
              if (filter_cb.checked) {
                window.location="{% url 'members_app:search_results' %}?q=" + q.value + "&board_only";
              } else {
                window.location="{% url 'members_app:search_results' %}?q=" + q.value;
              }
            }
          }
          q.addEventListener("keydown", function (event) { // listen for  key presses
              if (event.keyCode === 13) {                                 // '13' is the Enter/Return key
                  search_btn.click();                                      // emulate button click
              }
          })
          mobile_search_btn.onclick = function(event) {
            if (mobile_q.value.trim() == '') {
              event.preventDefault();
            } else {
              if (mobile_filter_cb.checked) {
                window.location="{% url 'members_app:search_results' %}?q=" + mobile_q.value + "&board_only";
              } else {
                window.location="{% url 'members_app:search_results' %}?q=" + mobile_q.value;
              }
            }
          }
          mobile_q.addEventListener("keydown", function (event) { // listen for  key presses
              if (event.keyCode === 13) {                                 // '13' is the Enter/Return key
                  mobile_search_btn.click();                                      // emulate button click
              }
          })
        {% endif %}
      </script>

      <script type="text/javascript">
        let pancake = document.querySelector('#pancake');
        let show_mobileNav = document.querySelector('#show_mobileNav');
        pancake.onclick = function() {
          $('#show_mobile_nav').click();
        }
      </script>

      <!-- Optional Javascript -->
      <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    </body>
  </html>
